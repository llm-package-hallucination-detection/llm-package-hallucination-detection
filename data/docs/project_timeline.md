# 프로젝트 진행 과정

## 목차
1. [프로젝트 주제 선정 과정 (2~4주차)](#1-프로젝트-주제-선정-과정-2~4주차)
2. [주제 세부화 및 기술 실험 (5~7주차)](#2-주제-세부화-및-기술-실험-5~7주차)
3. [데이터 수집 및 실험 설계 (8~9주차)](#3-데이터-수집-및-실험-설계-8~9주차)

---

## 1. 프로젝트 주제 선정 과정 (2~4주차)

### 2주차
**팀원별 아이디어 제안**
- 스테가노그래피 은닉 데이터 탐지 시스템
- AI 음성 합성 여부 판별 시스템
- 가짜 기지국 탐지 시스템

**결과**
- 교수님 피드백 후 주제 재조정 필요

---

### 3주차
**기존 주제 검토 및 새로운 아이디어 제안**
- IoT 기기 보안 취약점 실습
- 자율주행 보안 공격 실습 (OpenPilot 활용)
- 스테가노그래피 공격 파일 생성 라이브러리
- **Typosquatting(오타 기반 가짜 패키지) 공격 실습**

**결정 사항**
> **"Typosquatting을 이용한 가짜 패키지를 탐지하는 툴 개발"로 최종 결정**

---

## 2. 주제 세부화 및 기술 실험 (5~7주차)

### 5주차
**초기 계획: Typosquatting 탐지 툴**
- 패키지명 오타 + 발각된 가짜 패키지 DB 활용 계획
- npm에 오타 기반 패키지 등록 실험 진행

**문제 발견**
```
npm에서 이미 Typosquatting 방지 기능(오타 자동 검증) 확인됨
→ 레지스트리의 내부 방어 메커니즘과 연구 방향 충돌
→ 실험 재현 가능성 낮음
```

**주제 전환 회의**
- 새로운 아이디어: **LLM의 패키지 환각(Package Hallucination) 현상**
- LLM이 실제 존재하지 않는 패키지를 추천하는 문제점 발견

**최종 결정**
> **"LLM의 패키지 환각 현상을 악용한 공격 실험 및 방어 기술 연구"**

**전환 근거**
- 레지스트리의 내부 방어 메커니즘과 우리가 처음 기대한 '한 글자 차이로 통과되는 공격'의 유효성이 겹침
- LLM 환각 기반 실험이 보안적 의미와 실험 재현 가능성 측면에서 더 타당

---

### 6주차
**LLM 환각 현상 실험 설계**
- LLM을 이용한 "존재하지 않는 패키지명" 추천/생성 시나리오 설계
- 활용 모델 조사 시작 (무료 LLM 위주)

---

### 7주차
**LLM 모델 선정 및 프롬프트 설계**

**모델 후보**
- CodeLlama-13B
- CodeLlama-7B
- StarCoder2 (bigcode/starcoder2)
- StarCoder (original)
- Mistral-7B
- Qwen-7B
- DeepSeek-Coder

**기술 구현**
- npm 패키지명 존재 여부 검증 코드 제작 (`npm-name` 활용)
- 프롬프트 데이터 수집:
  1. 일반 코드 질문
  2. StackOverflow 기반 80개 질문 추출

**참고 논문**
- [We Have a Package for You! A Comprehensive Analysis of Package Hallucinations by Code Generating LLMs](https://www.usenix.org/system/files/conference/usenixsecurity25/sec25cycle1-prepub-742-spracklen.pdf)

---

## 3. 데이터 수집 및 실험 설계 (8~9주차)

### 8주차
**Prompt 데이터셋 제작**

**데이터셋 속성**
- `question_num`: 질문 번호
- `category`: 질문 카테고리
- `question_type`: 질문 유형
- `question_prompt`: 질문 내용
- `response_prompt`: 응답 내용

**System Prompt 4종 구성**
| Prompt Type | 설명 |
|------------|------|
| `CODE_GEN` | 코드 생성 중심 |
| `PKG_DETERMINE` | 필요한 패키지 판단 |
| `PKG_RECOMMEND` | 관련 패키지 추천 |
| `STDONLY` | 표준 기능만 사용 |

**목표**
- 약 **2만 개 프롬프트** 생성
- **중간 목표**: 어떤 카테고리에서 환각 패키지가 많이 발생하는지 분석
- **최종 목표**: 환각 패키지 공격 실증 실험 및 방어 방법 제안

**역할 분담**
- **김민경**: 카테고리 분류 및 프롬프트 확장
- **안준엽**: 프롬프트 분류 및 정제
- **김태욱/김동재**: LLM 테스트 환경 구축 및 실행

---

### 9주차
**LLM 모델별 테스트 본격 진행**

#### 실행 환경 변경
**초기 계획**
- 로컬에서 무료·저비용 오픈소스 모델 직접 실행

**제약 사항**
```
❌ 로컬 GPU 메모리 한계
❌ 모델별 추론 비용 및 시간
❌ 팀원 간 환경 통일의 어려움
❌ 반복 실험의 관리 부담
```

**해결 방안**
> **Together AI API 기반 실행으로 전환**
> - 클라우드 기반 오픈소스 LLM 지원
> - 안정적인 호출 환경

#### 모델별 담당자 (Together AI 환경)
| 담당자 | 모델 |
|--------|------|
| 안준엽 | google/gemma-3n-E4B-it |
| 김민경 | marin-8b-instruct |
| 김동재 | mistral-7B-instruct |
| 김태욱 | Qwen2.5-7B-instruct-turbo |
| 추가 | CodeLlama-13B |

---

### 실험 방법론

**실험 설정**
- 샘플 수: **100개**
- 반복 횟수: **30회**

**실험 단계**
1. 샘플을 100개 단위로 추출하고, 각 케이스를 30번 반복 수행
2. 시스템 프롬프트의 내용에 따라 키워드 추출 전략 선택
3. `normalize_npm_name()`으로 패키지명 정규화
4. `classify_package()`를 통해 추출된 단어를 다음 5가지로 분류:
   - Built-in Module
   - JS Keyword/Concept
   - NPM Package
   - NPM Package (Common Word)
   - Unknown/Invalid
5. npm registry API를 통해 실제 존재 여부 확인 및 캐시 저장
6. `verify_line()`으로 응답 내 해당 단어의 유효성 재검증

---

### 결과 파일 구조

```
results/
├── FINAL_verified_npm_[model]_try/
│   └── 각 테스트 케이스별 전체 결과
├── FINAL_verified_npm_[model]_unknown_try/
│   └── 검증되지 않은(unknown) 패키지 목록
└── FINAL_verified_npm_[model]_summary/
    └── 전체 결과 종합 요약 (분석 중심)
```

---

## 실험 결과 요약

### Qwen 모델
- **평균 탐지**: 112.8개/iteration
- **유효 NPM 패키지**: 약 70개
- **Unknown/Invalid**: 약 36개
- **오탐률**: 31.9% 
- **정탐률**: 68.1% 

### Marin 모델
- **평균 탐지**: 224.6개/iteration
- **유효 NPM 패키지**: 약 76개
- **Unknown/Invalid**: 약 143개
- **오탐률**: 63.6% 
- **정탐률**: 36.4% 

---

## 📈 모델 비교 분석

| 모델 | 평균 탐지 수 | 유효 패키지 | 오탐 수 | 오탐률 | 정탐률 |
|------|-------------|------------|---------|--------|--------|
| **Qwen** | 112.8 | 70 | 36.0 | 31.9% | **68.1%** |
| **Marin** | 224.6 | 76 | 142.9 | 63.6% | **36.4%** |

### 주요 발견
- Qwen 모델이 Marin 대비 **2배 높은 정확도** 보임
- Marin 모델은 더 많은 패키지를 탐지하지만 **오탐률이 2배 이상 높음**
- 두 모델 모두 상당한 비율의 **환각 증상(잘못된 패키지 추출)** 확인

---

## 다음 단계

- [ ] 추가 모델(Mistral, CodeLlama, Gemma) 실험 결과 통합
- [ ] 카테고리별 환각 발생 패턴 분석
- [ ] System Prompt별 환각 발생률 비교
- [ ] 방어 메커니즘 제안
- [ ] 최종 논문/보고서 작성

---

**Last Updated**: 2025년 9주차  
**Project Team**: 김동재, 김민경, 김태욱, 안준엽
